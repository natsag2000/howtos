#-*- mode: org; mode:visual-line; mode:org-indent -*-
#+TITLE: порт суваг татах зааврууд
#+AUTHOR: nagi
#+STARTUP: indent
#+STARTUP: hidestars

* Ерөнхий
суваг болж өгч байгаа сервер машин нь хэрэглэгчээс 22 гэсэн ssh портоор пакет хүлээж аваад интернэт рүү шаардагдах порт хэрэглэж, дунд нь суваг болж өгдөг. ( нэг л олигтой ойлгомжтой болж чадсангүй хэхэ )

хоёр янзын хэрэглээ байгаа. Хоёуланг нь зэрэг хэрэглэж болно. Яаж хэрэглэх нь ямар зорилгоор хэрэглэх гэж байгаагаас хамаарна (Бас л олигтой хэллэг болж чадсангүй :().
1. tsocks хэрэглэж суваг татах
2. ssh хэрэглэж суваг татах

* Нэгдүгээр арга:
- tsocks програмыг суулгана. ( анхдагч хэрэглэдэг порт нь 1080 )
- /etc/tsocks.conf файл дотор дараах оруулга байгаа эсэхийг магадла:
  server = 127.0.0.1
- порт суваг татах:
  ssh -D 1080  USERNAME@REMOTETUNNELSERVER -N -f
- суваг татагдсан тохиолдолд tsocks програмаар шаардлагатай програмаа ажиллуулж болно. Жишээ нь:
  tsocks cvs -z3 -d:pserver:anonymous@cvs.savannah.nongnu.org:/sources/certi co certi
  tsocks ftp -p -n ftp.mozilla.org
  ( -p сонголт нь пассив хэлбэрт оруулдаг. )

* хоёрдугаар арга:
Жишээ нь smtp imap хоёрын 465 болон 993 гэсэн портууд таны сүлжээнд хоригдсон байна гэж үзье. Би өөрийнхөө дотоод машин дээр энэ хоёр портыг хэрэглэхээр 4650 болон 9930 гэсэн хоёр портыг суваг болсон серверээр дамжуулж жинхэнэ холын серверийн 465 болон 993 гэсэн порттой холбож суваг татна. Өөрөөр хэлбэл, суваг болсон сервер нь холын жинхэнэ сервертэй нь холбогдох ёстой сдантарт 465 болон 993 гэсэн порттой нь холбогдоод миний машинтай болохоор 4650 болон 9930 гэсэн порттой холбогдож, надаас явуулсан хүсэлтийг цаад сервер лүү нь дамжуулж буцах хариултыг нь бас уг сервер нь юм шиг хариулт өгдөг (Миний юм тайлбарлах гэж ёстой хөгийн болжээ).
Тэгээд уг портыг хэрэглэх програм дээрээ (эмакс, аянгач шувуу гэх мэт) серверийн нэрийг нь localhost гэж өгөөд портуудыг нь 4650 болон 9930 гэж зааж өгнө (howto-gmail ээс зарим тохиргоог харж болно).
дараах тушаал нь гүүглийн захиаг шалгахын тулд (ssl) портуудыг өөрийнхөө портууд дээр суваг татах серверээр дамжуулан засаж байна:

 ssh -L 4650:smtp.gmail.com:465 USERNAME@TUNNELSERVER -N -f
 ssh -L 9930:imap.gmail.com:993 USERNAME@TUNNELSERVER -N -f

* Хянах
портууд дээр суваг татагдаад чагнаж байгааг нь дараах тушаалуудаар хараарай:
netstat -npl
or
netstat -ap

* Зарим хүндрэлийг засах арга
** Хэрэв тодорхой хугацааны дараа сервер салаад байвал

/etc/ssh/sshd_config файл дотор:
ClientAliveInterval 60
гэж нэмж өгөх, эсвэл

/etc/ssh/ssh_config дотор:
ServerAliveInterval 60
гэж оруулж өгнө (ФАЙЛЫН НЭРИЙГ АНХААРНА УУ).

** Хэрэв ssh холболт хийгдэхдээ удаад байвал
   config файлдаа дараах оруулгыг нэмнэ:
   UseDNS no
