#-*- mode: org; mode:visual-line; mode:org-indent -*-
#+STARTUP: indent
#+STARTUP: hidestars

* Үхрийн нууц

** Хос түлхүүр үүсгэх ( хувийн болон олон нийтэд зориулсан ) :create:generate:
   gpg --gen-key   тушаалаар дараах зүйлсийг гарнаас оруулах ёстой болдог
*** хувиргах алгоритм.
    анхдагчийг нь ашиглаж болно.
*** түлхүүрийн хэмжээ.
    1024 эсвэл 2048 хоёрын аль нэг байж болно.
*** түлхүүрийн хүчинтэй байх хугацаа
    - 0    = хугацаагүй
    - <n>  = n өдөр хүчинтэй  (жишээ: 3 )
    - <n>w = n долоо хоног хүчинтэй (жишээ: 32w )
    - <n>m = n сар хүчинтэй (жишээ: 6m )
    - <n>y = n жил хүчинтэй (жишээ: 3y )
*** түлхүүрийн хүчинтэй байх хугацаа лавлаж асууна
    Is this correct (y/n)? y  ( энтер дарж харснаа батлана, засварлахаар бол n дарна биз
*** хэрэглэгчийн таних нэрийг оруулна. Дараах загвараар оруулах хэрэгтэй
    Real name: Baldan Baatar (Baagii) <baagii@yanjin.com>
    \/           \/         \/
    бүтэн нэр       (хоч)  <захианы хаяг>
*** Нууц үг оруулах
    Өмнөх алхамуудад оруулсан бүх оруулгыг нэг дор харуулж лавлах бөгөөд O дарж баталгажуулаад дараа нь нууц үгээ оруулна.

** Түлхүүрээ экспортлох                                              :export:
   Хэн нэгэнд өөр лүүгээ нууцалсан захиа явуулуулахын тулд өөрийнхөө олон нийтийн түлхүүрээ бэлдэж өгөх хэрэгтэй.

   gpg --export -a Baldan Baatar > public_key.key
   эсвэл -o параметр ашиглах
   gpg --export -a -o public_key.key Baldan Baatar

** Түлхүүрээ импортлох                                               :import:
   Бусад хүмүүсийн нийтэд зориулсан түлхүүрийг импортлох
   gpg --import public_dulmaa_key.txt

** Түлхүүрүүдээ харах                                                  :view:
   Өөртөө байгаа бусад хүмүүсийн болон өөрийн нийтэд зориулсан түлхүүрүүдийг жагсаах
   gpg --list-keys
   gpg -k
   Зөвхөн өөрийн нууцлах түлхүүрүүдээ жагсаах
   gpg --list-secret-keys

** Байгаа түлхүүрүүдийн хурууны хээг харах
   түлхүүр болгонд өөрийн гэсэн давтагдашгүй хурууны хээ бий. Түүгээр нь жишиж харж мөн эсэхийг нь лавлаж харж болно.
   gpg --fingerprint

** Түлхүүр устгах                                                    :delete:
*** Нийтэд зориулсан түлхүүр устгах
    gpg --delete-key [UID]
    UID ийг --list-keys гэж харж болно. Эсвэл захианы хаяг, хэрэглэгчийн нэр ( дундаа зайтай байвал "" дотор бичнэ ) байж болно.
    жишээ нь:
    gpg --delete-key "Baldan Baatar"
    gpg --delete-key  baagii@yanjin.com гэх мэт

*** Нууц түлхүүр устгахаар бол
    gpg --delete-secret-key [UID]

** Түлхүүр засварлах                                     :edit:signing:trust:
   gpg --edit-key [UID]
   энэ тушаалыг өгөнгүүт гарнаас тушаал оруулах горимд ордог. HELP гэж өгвөл яаж засварлах заавар гарна.
   дараах хоёр чухал тушаалыг мэдэж авах нь зүйтэй:

*** гарын үсэглэж авах                                                 :sign:
    sign
    гэсэн тушаалаар уг гэрчилгээн дээр гарын үсэг зурна. Зөв түлхүүр гэдгийг энэ гарын үсгээр л баталгаажуулдаг.

*** итгэмжлэх                                                         :trust:
    trust
    тушаалаар уг түлхүүрэнд хэр их итгэж байгаагаа зааж өгнө.

** Файлд нууц хувиргалт хийх, гарын үсэг зурах            :encode:sign:check:
*** Нууц хувиргалт хийх
    gpg --recipient "Baldan Baatar" --encrypt --armor nuuts.txt
    --recipient гэдгээр хэн уншиж болохыг зааж өгнө. Энд импортлосон хүмүүсийн нэрийг тавьбал зөвхөн тэр хүн л уншина.
    --armor гэж өгснөөр хөрвүүлсэн файл нь АСКИ тэмдэгт хэлбэрээр байх болно. Өөр машин уруу зөөхөд тохиромжтой. Энэ заавар үгүй бол бинар хэлбэртэй байх болно.
    nuuts.txt файл дотор улс нураах гэж байгаа далан зургаан дуракийг яаж хусаж хаяад улсаа мандуулах бичиг баримт.
    Үр дүнд нь хэрэв --armor заалт хэрэглэсэн бол  nuuts.txt.asc, хэрэглээгүй бол nuuts.txt.gpg файл үүснэ.
*** Хувиргасан файлыг хөрвүүлэх
    gpg --recipient "Baldan Baatar" --decrypt nuuts.txt.armor > nuuts_unshih.txt
*** шалгах
    хэрэв нууцалж хувиргасан файлаа задлаад бүрэн эсэхийг нь шалгамаар бол
    diff nuut.txt nuuts_unshih.txt
    гэж шалгаж болно
*** Гарын үсэг зурах
    gpg --sign FILE
    Гарын үсэг зурагдсан файл нь уншигдахааргүй нууц хувиргалт хийгдсэн байдаг. Ердийн хувиргалтаас ялгаатай нь уг хүний хувийн түлхүүрээр хувиргадаг. Ингэснээр өөр хүн уг файлыг зөвхөн хувь хүн нь гарын үсэг зурж баталгаажуулсан байна гэдгийг нь шалгахдаа уг хүний нийтэд зориулсан түлхүүрээр задалж мэдэх болно.
    
**** Гарын үсгийг болиулах
     gpg --clearsign FILE

**** Файл нь уншигдаж болохоор гарын үсэг зурах
     gpg -b ( --armor ) FILE
     эсвэл
     gpg --detach-sign FILE
     -b нь бинар файлд ( архив файл) илүү тохиромжтой
     --armor файлаа АСКИ хэлбэрт хадгална

**** Гарын үсэг зураад нууцалж хөрвүүлэх
     gpg [ --local-user Илгээгч ] [ --recipient ХүлээнАвагч ] [--armor ] --sign --encrypt FILE
     [ ] засвар байгаа сонголтуудыг оруулсан ч болно, оруулахгүй орхисон ч болно.
     Хэрэв нууц хувиралт хийгдсэн файлд гарын үсэг зурсан байх юм бол буцааж хөрвүүлэх үед автоматаар гарын үсгийг шалгадаг.
     Хэрэв файлд нууц хувиргалт хийлгүй зөвхөн гарын үсэг зурсан бол дараах тушаалаар шалгаж болно.
     gpg [--verify] [Файл]
** Түлхүүрээ зөөвөрлөх                                            :transport:
   gpg --armor --export НЭРЭЭ > my_pub.key
   gpg --armor --export-secret-keys > my_sec.key

   дээрх хоёр файлыг зөөвөрлөх газраа аваачаад:
   gpg --import my_sec.key
   gpg --import my_pub.key

   Түлхүүрнүүд зөөгдөж орсон эсэхээ шалгахдаа
   gpg -k

** Түлхүүрээ серверт нийлүүлэх
   gpg --send-keys --keyserver gpg-keyserver.de 2BD5EA56

   ~/.gnupg/gpg.conf файлд хэрэв серверийн нэрийг:
   keyserver gpg-keyserver.de
   гэж оруулсан бол серверийг зааж өгөх алба үгүй.

** Бусдын түлхүүрийг серверээс олж суулгах
   gpg --recv-keys B1BCD037 --keyserver gpg-keyserver.de
** Эмакс дээр нууцлагдсан файл үүсгэх                          :emacs:encode:
   Эмакс дээр easyPG ийн тусламжтайгаар (23 аас эхлээд суугдсан буй) файлд хувиргалт хийх бүрэн боломжтой. Энэ файл нь хадгалагдах үед хувиргагдаад, нээгдэх үед сэргээж хувиргалт хийгдэн санах ойд байрладаг.
   Файлын толгойд дараах мөрийг оруулснаар файл хувиргалтанд орно.
   -*- mode: org -*- -*- epa-file-encrypt-to: ("my_key_email@foo.org") -*-
